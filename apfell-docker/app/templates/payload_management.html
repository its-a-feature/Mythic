{% extends "base.html" %}
{% block body %}
<div style="resize: vertical; overflow:scroll;max-height:calc(45vh); margin-top:5px" class="card border border-dark shadow bg-card-body" id="payloads_table" >
    <div class="card-header shadow border border-dark bg-header text-white"><h2>Operation <span class="operator">{{links.current_operation}}</span>'s Payload Information</h2></div>
        <table class="table table-condensed table-striped {{config['table-color']}} table-hover border border-dark shadow table-condensed" >
            <tr>
                <th><input type="checkbox" id="selectAllForDelete">&nbsp;<b>Delete</b></th>
                <th onclick="sort_table(this)"><b>Hosting</b></th>
                <th><b>Notify?</b></th>
                <th onclick="sort_table(this)"><b>Config</b></th>
                <th onclick="sort_table(this)"><b>Download</b></th>
                <th onclick="sort_table(this)"><b>Build Status</b></th>
                <th onclick="sort_table(this)"><b>Tag</b></th>
                <th onclick="sort_table(this)"><b>Creator</b></th>
                <th onclick="sort_table(this)"><b>Creation Time</b></th>
                <th onclick="sort_table(this)"><b>Payload Type</b></th>
                <th onclick="sort_table(this)"><b>C2 Profile</b></th>
                <th onclick="sort_table(this)"><b>File</b></th>
                <th onclick="sort_table(this)"><b>Hosted Name</b></th>
            </tr>
        <!-- Repeat this for each payload -->
            <tr v-for="p in payloads" :key="p.creation_time" v-show="!p.deleted">
                <td>
                    <input type="checkbox" v-model="p.checked"> <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="delete_button(p)" ><i class="fas fa-trash-alt"></i></button>
                </td>
                <td>
                    <template v-if="p.external">
                        <button type="button" disabled class=" btn btn{{config['outline-buttons']}}info btn-sm" data-toggle="tooltip" title="Payload created externally, can't host here. Use 'Services'->'Host Files'.">Can't Host</button>
                    </template>
                    <template v-else-if="p.build_phase != 'success'">
                        <button type="button" disabled class=" btn btn{{config['outline-buttons']}}info btn-sm" data-toggle="tooltip" title="Payload build failed or isn't done building">Can't Host</button>
                    </template>
                    <template v-else-if="p.hosted_path != ''">
                        <button type="button" class="btn btn{{config['outline-buttons']}}info btn-sm" @click="edit_hosting_path_button(p)"><i class="fas fa-edit"></i></button>
                    </template>
                    <template v-else>
                        <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="new_hosting_path_button(p)">Host</button>
                    </template>
		        </td>
                <td>
                    <span class="material-switch pull-right">
                        <input type="checkbox" :checked="p.callback_alert" v-model="p.callback_alert" @change="update_callback_alert(p)" :id="'callback_alert' + p.id" >
                        <label :for="'callback_alert' + p.id" class="btn-info"></label></span>
                </td>
                <td>
                    <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="show_parameters_button(p)">Config</button>
                </td>
                <td>
                    <a type="button" :disabled="p.external || p.deleted || p.build_phase == 'error'" class="btn btn{{config['outline-buttons']}}success btn-sm" :href="'{{http}}://{{links.server_ip}}:{{links.server_port}}{{links.api_base}}/payloads/download/' + p.uuid"><font color="#28a745"><i class="fas fa-download"></i></font></a>
                </td>
                <td >
                    <div v-if="p.build_phase == 'success'">
                        <i class="far fa-check-circle fa-2x" style="color:green"></i>
                    </div>
                    <div v-else-if="p.build_phase == 'error'">
                        <i class="fas fa-exclamation-triangle fa-2x" style="color:red"></i>
                    </div>
                    <div v-else>
                        <div class="spinner-border text-info" role="status"></div>
                    </div>
                </td>
                <td>[[ p.tag ]]</td>
                <td>[[ p.operator ]]</td>
                <td>[[ toLocalTime(p.creation_time) ]]</td>
                <td>[[ p.payload_type ]]</td>
                <td>[[ p.c2_profile ]]</td>
                <td>[[ p.location.split("/").slice(-1)[0] ]]</td>
                <td>
                    <template v-if="p.hosted_path != ''">
                        [[ p.hosted_path.split("/").slice(-1)[0] ]]
                    </template>
                    <template v-else>
                        Not Hosted
                    </template>
                </td>
            </tr>
        <!-- End of the repeating -->
        </table>
</div>
<button class="btn btn{{config['outline-buttons']}}danger btn-md" onclick="delete_selected_function()">Delete all Selected</button>

<!-- THIS IS OUR MODAL FOR DELETING PAYLOAD -->
<div class="modal fade" id="payloadDeleteModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3 id="modalLabel">Are you sure? This could have implications elsewhere.</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="payloadDeleteBody">
                   Mark the payload as deleted (and optionally delete from disk).<br><br>
                  <h4>Delete from disk:&nbsp;&nbsp;<span class="material-switch pull-right"><input type="checkbox" id="payloadDeleteFile"><label for="payloadDeleteFile" class="btn-danger"></label></span></h4>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadDeleteSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR DELETING PAYLOAD -->
<!-- THIS IS OUR MODAL FOR HOSTING PAYLOAD -->
<div class="modal fade" id="payloadNewHostModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3 >Host the payload at a custom endpoint</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="payloadNewHostBody">
                   Specify the name of the endpoint: <input id="payloadNewHostName" size="32" type="text">
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadNewHostSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR HOSTING PAYLOAD -->
<!-- THIS IS OUR MODAL FOR EDITING HOSTING PAYLOAD -->
<div class="modal fade" id="payloadEditHostModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3 >Edit the current hosting endpoint</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="payloadEditHostBody">
                  Specify the name of the endpoint: <input id="payloadEditHostName" size="32" type="text"><br><br>
                  Continue Hosting:&nbsp;&nbsp;<span class="material-switch pull-right"><input type="checkbox" id="payloadEditHostHost"><label for="payloadEditHostHost" class="btn-warning"></label></span>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadEditHostSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR EDITING HOSTING PAYLOAD -->
<!-- THIS IS OUR MODAL FOR GETTING PAYLOAD CONFIG -->
<div class="modal fade" id="payloadConfigModal" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Viewing payload configuration</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
            <div class="modal-body" >
              <table class="table table-striped {{config['table-color']}} table-hover" style="table-layout:fixed;word-wrap: break-word">
                    <tr v-if="config.commands != undefined" align="center">
                        <th><b>Loaded Commands</b></th>
                        <th><b>Loaded Version</b></th>
                        <th><b>Apfell Version</b></th>
                    </tr>
                  <tr v-for="c in config.commands" v-if="config.commands != undefined" :style="c.version != c.apfell_version ? 'background-color:{{config.failure_highlight}}' : ''">
                      <td>[[c.cmd]]</td>
                      <td>[[c.version]]</td>
                      <td>[[c.apfell_version]]</td>
                  </tr>
                  <tr><td><b>C2 Profile Param Name</b></td>
                      <td colspan="2"><b>C2 Profile Param Value</b></td>
                  </tr>
                  <tr v-for="p in config.c2_profile_parameters_instance">
                      <td>[[p.c2_profile_name]]</td>
                      <td colspan="2">[[p.value]]</td>
                  </tr>
                  <tr>
                      <td>Build Message</td>
                      <td colspan="2">[[config.build_message]]</td>
                  </tr>
                  <tr>
                      <td>UUID</td>
                      <td colspan="2">[[config.uuid]]</td>
                  </tr>
              </table>
            </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal">Close</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR GETTING PAYLOAD CONFIG -->
<br><br>

<button type="button" class="btn btn{{config['outline-buttons']}}success btn-md" onclick="create_payloadtype_button()"><i class="fas fa-plus"></i> PayloadType</button>
<button type="button" class="btn btn{{config['outline-buttons']}}info btn-md" onclick="import_payload_button()" data-toggle="tooltip" title="Import new payload type"><i class="fas fa-file-import"></i></button>
<br>
<!-- PAYLOAD TYPE AND COMMAND INFORMATION/MODIFICATION/CREATION HERE -->
<div style="resize: vertical; overflow:visible; height:calc(40vh)" class="card border border-dark shadow bg-card-body" id="payloadtypes_table" >
    <div class="card-header bg-header text-white border border-dark shadow"><h2>Global <span class="operator">Payload Type</span> and <span class="operator">Command</span> Information</h2></div>
        <div class="card-body border border-dark bg-card-body shadow">
            <div class="card border-0 bg-transparent " v-for="(p, i) in payloadtypes" :key="p.id" style="display:inline-block;padding:8px">
                <div class="card border border-dark align-top shadow" style="display: inline-block;width:30em">
                    <div class="card-header border border-dark bg-header-dark shadow">
                        <img src="/static/apfell-transparent.png" class="card-img-top" alt="..." style="width:100px;height:100px">
                        <template v-if="p.external && !p.container_running">
                            <div class="led-blue" data-toggle="tooltip" title="Creation hosted externally and no local container running" style="display:inline-block"></div>
                        </template>
                        <template v-else-if="p.container_running">
                            <div class="led-green" data-toggle="tooltip" title="Payload created within Apfell, or external payload type has running container" style="display:inline-block"></div>
                        </template>
                        <template v-else>
                            <div class="led-red" style="display:inline-block" data-toggle="tooltip" title="No heartbeat from container in over 30 seconds"></div>
                        </template>
                        &nbsp;<a class="btn btn-link"  style="word-wrap: break-word" type="button" data-toggle="collapse" :data-target="'#payloadtypecardbody' + p.id" aria-expanded="false" :aria-controls="'payloadtypecardbody' + p.id"><font size="6"><b>[[p.ptype]]</b></font></a>
                        <img :id="'dropdownarrow' + p.id" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)" >
                    </div>
                    <div class="collapse show" :id="'payloadtypecardbody' + p.id">
                        <div class="card-body border border-dark bg-card-body-l2 shadow">
                            <b>Supported OS:</b> [[p.supported_os]]<br>
                            <b>Number of Commands:</b> [[p.commands.length]]<br>
                            <b>Commands:</b>
                            <button class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_commands_button(p)"><i class="fas fa-plus"></i></button>
                            <button class="btn btn{{config['outline-buttons']}}warning btn-sm" @click="edit_commands_button(p)"><i class="fas fa-edit"></i> </button>
                            <button class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_commands_button(p)"><i class="fas fa-trash-alt"></i></button>
                          </div>
                    </div>
                    <div class="card-footer border border-dark shadow">
                        <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="delete_payloadtype_button(p)" ><i class="fas fa-trash-alt"></i></button>
                        <button type="button" class="btn btn{{config['outline-buttons']}}info btn-sm" @click="export_commands_button(p)" data-toggle="tooltip" title="Export payload type and commands"><i class="fas fa-file-export"></i></button>
                        <div class="dropdown" style="display:inline-block">
                              <button class="btn btn{{config['outline-buttons']}}warning btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-edit"></i>
                              </button>
                              <div class="dropdown-menu">
                                  <button class="dropdown-item" @click="edit_payloadtype_button(p)">Edit Info and Files</button>
                                  <button class="dropdown-item" @click="edit_create_transforms_button(p, i)">Edit "Create" Transforms</button>
                                  <button class="dropdown-item" @click="edit_load_transforms_button(p, i)">Edit "Load" Transforms</button>
                              </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>
<!-- THIS IS OUR MODAL FOR CREATING PAYLOADTYPE -->
<div class="modal fade" id="payloadtypeCreateModal" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Register a new PayloadType</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="payloadtypeCreateBody">
                  <table cellpadding="10" style="width:100%" class="table table-striped {{config['table-color']}} table-hover">
                      <tr>
                          <th><b>Parameter</b></th>
                          <th><b>Value</b></th>
                      </tr>
                    <tr>
                        <td style="width:300px">Name</td>
                        <td><input type="text" id="payloadtypeCreatePtype" size="50"></td>
                    </tr>
                      <tr>
                          <td style="width:300px">Payload file extension</td>
                          <td><input type="text" id="payloadtypeCreateFileExtension" size="50"></td>
                      </tr>
                      <tr>
                          <td>Supported OS:</td>
                          <td>
                              <select multiple id="payloadtypeCreateSupportedOS" size="6">
                                  <option value="linux (x86)">Linux (x86)</option>
                                  <option value="linux (x64)">Linux (x64)</option>
                                  <option value="macOS (x86)">macOS (x86)</option>
                                  <option value="macOS (x64)">macOS (x64)</option>
                                  <option value="Windows (x86)">Windows (x86)</option>
                                  <option value="Windows (x64)">Windows (x64</option>
                              </select>
                          </td>
                      </tr>
                      <tr>
                          <td style="width:300px">Is this payload a wrapper for another payload?</td>
                          <td><span class="material-switch pull-right"><input type="checkbox" id="payloadtypeCreateWrapper"><label for="payloadtypeCreateWrapper" class="btn-info"></label></span></td>
                      </tr>
                      <tr hidden id="payloadtypeCreateWrappedPayloadTypeRow">
                          <td style="width:300px">What kind of payload does this wrap?</td>
                          <td>
                              <select id="payloadtypeCreateWrappedPayloadType">

                              </select>
                          </td>
                      </tr>
                      <tr>
                          <td style="width:450px">Is this payload going to be created externally to Apfell?</td>
                          <td><span class="material-switch pull-right"><input type="checkbox" id="payloadtypeCreateExternal"><label for="payloadtypeCreateExternal" class="btn-info"></label></span></td>
                      </tr>
                      <tr>
                          <td>Select payload code files to upload:</td>
                          <td><input multiple type="file" id="payloadtypeCreateUploadFiles"></td>
                      </tr>
                      <tr>
                          <td>Select files to upload to container:</td>
                          <td><input multiple type="file" id="payloadtypeCreateUploadContainerFiles"></td>
                      </tr>
                      <tr>
                          <td>Helpful information for executing the payload:</td>
                          <td><textarea id="payloadtypeCreateExecuteHelp" rows="5" cols="80"></textarea></td>
                      </tr>
                      <tr>
                          <td>Specify a template for adding commands:</td>
                          <td id="add_command_template">
                              Theme: <select v-model="theme"><option v-for="t in theme_options" :value="t">[[t]]</option></select>
                              Language: <select v-model="language"><option v-for="l in language_options" :value="l">[[l]]</option></select>
                              <ace-editor v-model="command_template" min-lines="3" max-lines="20" :theme="theme" :mode="language" wrap="true"></ace-editor>
                          </td>
                      </tr>
            </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadtypeCreateSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR CREATING PAYLOADTYPE -->
<!-- THIS IS OUR MODAL FOR EDITING PAYLOADTYPE -->
<div class="modal fade" id="payloadtypeEditModal" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Edit the payload type</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body">
                  <table cellpadding="10" style="width:100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th><b>Parameter</b></th>
                          <th><b>Value</b></th>
                      </tr>
                    <tr>
                        <td style="width:300px">Name</td>
                        <td><input type="text" id="payloadtypeEditPtype" size="50"></td>
                    </tr>
                      <tr>
                          <td style="width:150px">Payload file extension</td>
                          <td><input type="text" id="payloadtypeEditFileExtension" size="50"></td>
                      </tr>
                      <tr>
                          <td>Supported OS:</td>
                          <td>
                              <select multiple id="payloadtypeEditSupportedOS" size="6">
                                  <option value="linux (x86)">Linux (x86)</option>
                                  <option value="linux (x64)">Linux (x64)</option>
                                  <option value="macOS (x86)">macOS (x86)</option>
                                  <option value="macOS (x64)">macOS (x64)</option>
                                  <option value="Windows (x86)">Windows (x86)</option>
                                  <option value="Windows (x64)">Windows (x64)</option>
                              </select>
                          </td>
                      </tr>
                      <tr>
                          <td style="width:300px">Is this payload a wrapper for another payload?</td>
                          <td><span class="material-switch pull-right"><input type="checkbox" id="payloadtypeEditWrapper"><label for="payloadtypeEditWrapper" class="btn-info"></label></span></td>
                      </tr>
                      <tr hidden id="payloadtypeEditWrappedPayloadTypeRow">
                          <td style="width:150px">What kind of payload does this wrap?</td>
                          <td>
                              <select id="payloadtypeEditWrappedPayloadType">

                              </select>
                          </td>
                      </tr>
                      <tr>
                          <td style="width:300px">Is this payload going to be created externally to Apfell?</td>
                          <td><span class="material-switch pull-right"><input type="checkbox" id="payloadtypeEditExternal" ><label for="payloadtypeEditExternal" class="btn-info"></label></span></td>
                      </tr>
                      <tr>
                          <td style="vertical-align:top">Helpful information for executing the payload:</td>
                          <td><textarea id="payloadtypeEditExecuteHelp" rows="5" cols="80"></textarea></td>
                      </tr>
                      <tr>
                          <td style="vertical-align:top">Specify a template for adding commands:</td>
                          <td  id="edit_command_template">
                              Theme: <select v-model="theme"><option v-for="t in theme_options" :value="t">[[t]]</option></select>
                              Language: <select v-model="language"><option v-for="l in language_options" :value="l">[[l]]</option></select>
                              <ace-editor v-model="command_template" min-lines="3" max-lines="20" :theme="theme" :mode="language" wrap="true"></ace-editor>
                          </td>
                      </tr>
                </table>
                  <div id="payloadtypeEditFiles">
                      <template v-if="folders.length > 0" v-for="(folder, i) in folders">
                        <table class="table table-condensed table-striped {{config['table-color']}} table-hover" width="100%">
                            <tr>
                                <th align="left" width="50"><b>Delete</b></th>
                                <th align="left" width="50"><b>Download</b></th>
                                <th align="left"><b>
                                    <div v-if="folder.folder.includes('/Apfell/')">Server files</div>
                                    <div v-else>Agent Files: [[folder.folder]] </div>
                                    </b>
                                </th>
                                <th align="right"  style="width:11rem">
                                    <template v-if="!folder.folder.includes('/Apfell/')">
                                        <button class="btn btn{{config['outline-buttons']}}success" @click="upload_agent_file(folder)"><i class="fas fa-file-upload fa-lg"></i></button>
                                        <button class="btn btn{{config['outline-buttons']}}success" @click="add_sub_folder(folder)"><i class="fas fa-folder-plus fa-lg"></i></button>
                                        <button class="btn btn{{config['outline-buttons']}}danger" @click="remove_folder(folder, i)"><i class="fas fa-folder-minus fa-lg"></i></button>
                                    </template>
                                    <template  v-else>
                                        <button class="btn btn{{config['outline-buttons']}}success" @click="upload_container_file(folder)"><i class="fas fa-file-upload fa-lg"></i></button>
                                    </template>
                                </th>
                            </tr>
                            <template v-for="file in folder.filenames">
                                <tr>
                                    <td><button class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="delete_file_button(folder.folder, file)"><i class="fas fa-trash-alt"></i></button></td>
                                    <td><button class="btn btn{{config['outline-buttons']}}success btn-sm" @click="download_file_button(folder.folder, file)">Download</button></td>
                                    <td>[[file]]</td>
                                    <td></td>
                                </tr>
                            </template>
                        </table>
                    </template>

                  </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadtypeEditSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR EDITING PAYLOADTYPE -->
<!-- START MODAL FOR ADDING FOLDER -->
<div class="modal fade" id="payloadtypeEditFilesAddFolder" role="dialog">
  <div class="modal-dialog modal-md" role="document">
      <div class="modal-content">
          <div class="modal-header bg-dark text-white">
              <h3>New sub-folder name</h3>
              <button type="button" class="close"  onclick="hide_modal('payloadtypeEditFilesAddFolder')">×</button>
          </div>
          <div class="modal-body" id="payloadtypeEditFilesAddFolderBody">
              <input type="text" id="payloadtypeEditFilesAddFolderName" size="50">
          </div>
          <div class="modal-footer">
            <button class="btn btn{{config['outline-buttons']}}warning" onclick="hide_modal('payloadtypeEditFilesAddFolder')" aria-hidden="true">Cancel</button>
            <button class="btn btn{{config['outline-buttons']}}primary" id="payloadtypeEditFilesAddFolderSubmit">Submit</button>
          </div>
      </div>
  </div>
</div>
<!-- END MODAL FOR ADDING FOLDER -->
<!-- START MODAL FOR UPLOADING FILE -->
<div class="modal fade" id="payloadtypeEditFilesAddFile" role="dialog">
  <div class="modal-dialog modal-md" role="document">
      <div class="modal-content">
          <div class="modal-header bg-dark text-white">
              <h3>Select Files to Upload</h3>
              <button type="button" class="close"  onclick="hide_modal('payloadtypeEditFilesAddFile')">×</button>
          </div>
          <div class="modal-body">
                 <input multiple type="file" id="payloadtypeEditFilesUploadFile">
          </div>
          <div class="modal-footer">
            <button class="btn btn{{config['outline-buttons']}}warning" onclick="hide_modal('payloadtypeEditFilesAddFile')" aria-hidden="true">Cancel</button>
            <button class="btn btn{{config['outline-buttons']}}primary" id="payloadtypeEditFilesAddFileSubmit">Submit</button>
          </div>
      </div>
  </div>
</div>
<!-- END MODAL FOR UPLOADING FILE -->
<!-- THIS IS OUR MODAL FOR DELETING PAYLOADTYPE -->
<div class="modal fade" id="payloadtypeDeleteModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Delete a PayloadType</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="payloadtypeDeleteBody">
                  Are you sure? This will automatically delete payloads created from this payload type, callbacks associated with those payloads, and more.<br><br>
                  Delete from disk? &nbsp;<span class="material-switch pull-right"><input type="checkbox" id="payloadtypeDeleteFromDisk"><label for="payloadtypeDeleteFromDisk" class="btn-danger"></label></span></label>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadtypeDeleteSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR DELETING PAYLOADTYPE -->
<!-- THIS IS OUR MODAL FOR IMPORTING COMMAND -->
<div class="modal fade" id="commandImportModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Import JSON file</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="commandImportBody">
                   File should contain the payload type and associated information
                  <input type="file" id="commandImportFile">
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="commandImportSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR IMPORTING COMMAND -->
<!-- THIS IS OUR MODAL FOR REMOVING COMMANDS -->
<div class="modal fade" id="commandRemoveModal" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Remove commands from payload type</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="commandRemoveBody">
                <table class="table table-striped table-hover {{config['table-color']}}">
                    <tr>
                        <td>
                            Select commands to remove:
                        </td>
                        <td>
                            <select multiple id="commandRemoveList" size="20">
                            </select>
                        </td>
                    </tr>
                </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}danger" data-dismiss="modal" id="commandRemoveSubmit">Remove</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR REMOVING COMMANDS -->
<!-- THIS IS OUR MODAL FOR ADDING COMMANDS -->
<div class="modal fade" id="commandAddModal" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Add a Command</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="commandAddBody">
                <table style="word-wrap: break-word" class="table table-striped table-hover {{config['table-color']}}">
                    <tr>
                        <td> Command Name: </td>
                        <td>
                            <input type="text" id="commandAddCmd" size="50">
                            <button class="btn btn{{config['outline-buttons']}}info" id="commandAddCheckCmd">Check Name</button>
                            <span hidden id="commandExists" class="alert alert-danger">Command Exists</span>
                            <span hidden id="commandDoesNotExist" class="alert alert-success">Command Does Not Exist</span>
                        </td>
                    </tr>
                    <tr>
                        <td> Description: </td>
                        <td><input type="text" id="commandAddDescription" size="90"></td>
                    </tr>
                    <tr>
                        <td> Help: </td>
                        <td><input type="text" id="commandAddHelpCmd" size="90"></td>
                    </tr>
                    <tr>
                        <td> Needs Admin: </td>
                        <td><span class="material-switch pull-right"><input type="checkbox" id="commandAddNeedsAdmin"><label for="commandAddNeedsAdmin" class="btn-info"></label></span></td>
                    </tr>
                    <tr>
                        <td> Version: </td>
                        <td> <input type="number" id="commandAddVersion"></td>
                    </tr>
                    <tr>
                        <td> Is Exit Command:</td>
                        <td><span class="material-switch pull-right"><input type="checkbox" id="commandAddIsExit"><label for="commandAddIsExit" class="btn-info"></label></span></td>
                    </tr>
                    <tr>
                        <td> Is Used For File Browsing:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandAddIsFileBrowse" ><label for="commandAddIsFileBrowse" class="btn-info"></label></span>
                            <div hidden id="commandAddIsFileBrowseSelected">
                                Parameters to call this command: " * " will be replaced with the path to browse<br>
                                <input type="text" id="commandAddFileBrowseParameters" size="80" placeholder="*">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Is Used for Process Listing:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandAddIsProcessList"><label for="commandAddIsProcessList" class="btn-info"></label></span>
                            <div hidden id="commandAddIsProcessListSelected">
                                Parameters to call this command:<br>
                                <input type="text" id="commandAddProcessListParameters" size="80" placeholder="*">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Is Used for Downloading Files:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandAddIsDownloadFile"><label for="commandAddIsDownloadFile" class="btn-info"></label></span>
                            <div hidden id="commandAddIsDownloadFileSelected">
                                Parameters to call this command: " * " will be replaced with the path to download<br>
                                <input type="text" id="commandAddDownloadFileParameters" size="80" placeholder="*">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Is Used for Removing Files:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandAddIsRemoveFile"><label for="commandAddIsRemoveFile" class="btn-info"></label></span>
                            <div hidden id="commandAddIsRemoveFileSelected">
                                Parameters to call this command: " * " will be replaced with the path to remove<br>
                                <input type="text" id="commandAddRemoveFileParameters" size="80" placeholder="*">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Code: </td>
                        <td id="add_command_code">
                            Theme: <select v-model="theme"><option v-for="t in theme_options" :value="t">[[t]]</option></select>
                            Language: <select v-model="language"><option v-for="l in language_options" :value="l">[[l]]</option></select>
                            <ace-editor v-model="code" min-lines="3" max-lines="15" :theme="theme" :mode="language" wrap="true"></ace-editor>
                            <input type="file" id="commandAddFile">
                        </td>
                    </tr>
                </table>
                  <h3>Command Parameters:</h3>
                  <table id="add_command_parameters_table" class="table table-striped table-hover {{config['table-color']}}">
                      <tr v-for="(i,p) in add_command_parameters" :key="i.id">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_parameter_button(i,p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                        <td>
                            &nbsp;Name: <input type="text" size="30" :value="i.name" v-model="i.name">
                        </td>
                          <td>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Required? <span class="material-switch pull-right"><input type="checkbox" :value="i.required" v-model="i.required" :id="'required' + p"><label :for="'required' + p" class="btn-info"></label></span>
                          </td>
                          <td>
                              &nbsp;&nbsp;Type: <select v-model="i.type">
                                        <option value="Select One...">Select One...</option>
                                        <option value="String">String</option>
                                        <option value="Boolean">Boolean</option>
                                        <option value="File">File</option>
                                        <option value="Array">Array</option>
                                        <option value="Choice">Choose One</option>
                                        <option value="ChoiceMultiple">Choose Many</option>
                                        <option value="Credential">Credential</option>
                                        <option value="Number">Number</option>
                                    </select>
                          </td>
                        <td>
                            <div v-if="i.type == 'String'">
                                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hint: <input type="text" size="31" :value="i.hint" v-model="i.hint">
                            </div>
                            <div v-if="i.type == 'Choice' || i.type == 'ChoiceMultiple'">
                                &nbsp;&nbsp;Option per line: <textarea size="31" :value="i.choices" v-model="i.choices"></textarea>
                            </div>

                        </td>
                    </tr>
                      <tr>
                          <td colspan="5">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_parameter_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
                  <h3>Command Transforms:</h3>
                  <table id="add_command_transforms_table" width="100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th></th>
                          <th align="center"><b>Step</b></th>
                          <th align="center"><b>Transform</b></th>
                          <th align="center"><b>Parameter</b></th>
                      </tr>
                      <tr>
                          <td></td>
                          <td align="center">0</td>
                          <td align="center">Get Task Parameters</td>
                          <td align="center">Takes no parameters</td>
                      </tr>
                      <tr v-for="(i,p) in add_command_transforms" :key="i.order">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_command_transform_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                          <td align="center"><input type="number" :value="i.order" v-model="i.order" min="1" style="width: 4em"></td>
                          <td align="center">
                              <select id="'commandTransformsOptions' + p" v-model="i.name"><option v-for="(item, key, index) in transformOptions" :value="key">[[key]]</option></select>
                          </td>
                          <td align="center">
                              <div v-if="transformOptions[i.name].hasOwnProperty('parameter')">
                                  <input type="text" size="31" :value="i.parameter" v-model="i.parameter" :placeholder="transformOptions[i.name].parameter">
                              </div>
                              <div v-else>
                                  Takes no parameters
                              </div>
                          </td>
                      </tr>
                      <tr>
                          <td colspan="4">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_command_transform_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
                  <h3>ATT&CK Mapping:</h3>
                  <table id="add_command_attack_table" width="100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th></th>
                          <th>ATT&CK Technique</th>
                      </tr>
                      <tr v-for="(i, p) in add_attack_command" :key="i.t_num">
                          <td>
                              <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_command_attack_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                          </td>
                          <td>
                              <select v-model="i.t_num"><option v-for="item in attackOptions" :value="item.t_num">[[item.t_num]] - [[item.name]]</option></select>
                          </td>
                      </tr>
                      <tr>
                          <td colspan="2">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_command_attack_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
                  <h3>Command Artifacts</h3>
                  <table id="add_command_artifacts_table" width="100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th></th>
                          <th>Base Artifact</th>
                          <th>Linked Parameter</th>
                          <th>Artifact</th>
                          <th>Replace String</th>
                      </tr>
                      <tr v-for="(i, p) in add_command_artifact" :key="i.id">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_command_artifact_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                          <td>
                              <select v-model="i.artifact"><option v-for="item in baseArtifacts" :value="item.id">[[item.name]]</option></select>
                          </td>
                          <td>
                              <select v-model="i.command_parameter"><option value="-1">No Parameter</option><option v-for="item in commandParameters" :value="item.id">[[item.name]]</option></select>
                          </td>
                          <td>
                              <textarea v-model="i.artifact_string" :value="i.artifact_string" cols="60"></textarea>
                          </td>
                          <td>
                              <input type="text" size="10" v-model="i.replace_string" :value="i.replace_string">
                          </td>
                      </tr>
                      <tr>
                          <td colspan="5">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_command_artifact_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true" id="commandAddCancel">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="commandAddSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR ADDING COMMANDS -->
<!-- THIS IS OUR MODAL FOR EDITING COMMANDS -->
<div class="modal fade" id="commandEditModal" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Edit a Command</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body">
                <table class="table table-striped table-hover {{config['table-color']}}" style="word-wrap: break-word" id="commandEditTable">
                    <tr>
                        <td> Command Name: </td>
                        <td><select id="commandEditCmd" v-model="selected_command"><option v-for="c in commands" :value="c">[[c.cmd]]</option></select></td>
                    </tr>
                    <tr>
                        <td> Description: </td>
                        <td><input type="text" id="commandEditDescription" size="90" v-model="description"></td>
                    </tr>
                    <tr>
                        <td> Help: </td>
                        <td><input type="text" id="commandEditHelpCmd" size="90" v-model="help_cmd"></td>
                    </tr>
                    <tr>
                        <td> Needs Admin: </td>
                        <td><span class="material-switch pull-right"><input type="checkbox" id="commandEditNeedsAdmin" v-model="needs_admin">
                        <label for="commandEditNeedsAdmin" class="btn-info"></label></span></td>
                    </tr>
                    <tr>
                        <td> Currently Editing Version: </td>
                        <td> [[version]]</td>
                    </tr>
                    <tr>
                        <td> Is Exit Command:</td>
                        <td><span class="material-switch pull-right"><input type="checkbox" id="commandEditIsExit" v-model="is_exit">
                        <label for="commandEditIsExit" class="btn-info"></label></span></td>
                    </tr>
                    <tr>
                        <td> Is Used For File Browsing:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandEditIsFileBrowse" v-model="is_file_browse">
                                <label for="commandEditIsFileBrowse" class="btn-info"></label></span>
                            <div :hidden="!is_file_browse" id="commandEditIsFileBrowseSelected">
                                Parameters to call this command: " * " will be replaced with the path to browse<br>
                                <input type="text" id="commandEditFileBrowseParameters" size="80" placeholder="*" v-model="file_browse_parameters">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Is Used for Process Listing:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandEditIsProcessList" v-model="is_process_list">
                                <label for="commandEditIsProcessList" class="btn-info"></label></span>
                            <div :hidden="!is_process_list" id="commandEditIsProcessListSelected">
                                Parameters to call this command:<br>
                                <input type="text" id="commandEditProcessListParameters" size="80" placeholder="*" v-model="process_list_parameters">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Is Used for Downloading Files:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandEditIsDownloadFile" v-model="is_download_file">
                                <label for="commandEditIsDownloadFile" class="btn-info"></label></span>
                            <div :hidden="!is_download_file" id="commandEditIsDownloadFileSelected">
                                Parameters to call this command: " * " will be replaced with the path to download<br>
                                <input type="text" id="commandEditDownloadFileParameters" size="80" placeholder="*" v-model="download_file_parameters">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Is Used for Removing Files:</td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" id="commandEditIsRemoveFile" v-model="is_remove_file">
                                <label for="commandEditIsRemoveFile" class="btn-info"></label></span>
                            <div :hidden="!is_remove_file" id="commandEditIsRemoveFileSelected">
                                Parameters to call this command: " * " will be replaced with the path to remove<br>
                                <input type="text" id="commandEditRemoveFileParameters" size="80" placeholder="*" v-model="remove_file_parameters">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td> Code for [[filename]]: <br><button class="btn btn{{config['outline-buttons']}}success btn-sm" @click="save_changes()"><i class="fas fa-save fa-lg"></i></button></td>
                        <td id="edit_command_code" >
                            Theme: <select v-model="theme"><option v-for="t in theme_options" :value="t">[[t]]</option></select>
                            Language: <select v-model="language"><option v-for="l in language_options" :value="l">[[l]]</option></select>
                            <ace-editor v-model="code" min-lines="3" max-lines="30" :theme="theme" :mode="language" wrap="true"></ace-editor>
                        </td>
                    </tr>
                    <tr><td colspan="2">
                        <template v-if="folders.length > 0" v-for="(folder, i) in folders">
                            <table class="table table-condensed" width="100%" style="color:{{config['text-color']}}">
                                <tr>
                                    <th align="left" width="50"><b>Delete</b></th>
                                    <th align="left" width="50"><b>Download</b></th>
                                    <th align="left"><b>
                                        Code Files: [[folder.folder]]
                                        </b>
                                    </th>
                                    <th align="right"  style="width:11rem">
                                        <button class="btn btn{{config['outline-buttons']}}success" @click="upload_agent_file(folder)"><i class="fas fa-file-upload fa-lg"></i></button>
                                        <button class="btn btn{{config['outline-buttons']}}success" @click="add_sub_folder(folder)"><i class="fas fa-folder-plus fa-lg"></i></button>
                                        <button class="btn btn{{config['outline-buttons']}}danger" @click="remove_folder(folder, i)"><i class="fas fa-folder-minus fa-lg"></i></button>
                                    </th>
                                </tr>
                                <template v-for="file in folder.filenames">
                                    <tr>
                                        <td><button class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="delete_file_button(folder, file)"><i class="fas fa-trash-alt"></i></button></td>
                                        <td><button class="btn btn{{config['outline-buttons']}}success btn-sm" @click="download_file_button(folder.folder, file)">Download</button></td>
                                        <td>[[file]]</td>
                                        <td><button class="btn btn{{config['outline-buttons']}}info btn-sm" @click="send_to_edit(folder.folder, file)"><i class="fas fa-edit fa-lg"></i></button></td>
                                    </tr>
                                </template>
                            </table>
                        </template>
                    </td></tr>
                </table>
                  <h3>Command Parameters:</h3>
                  <table id="edit_command_parameters_table" class="table table-striped table-hover {{config['table-color']}}">
                      <tr v-for="(i,p) in command_parameters" :key="i.id">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_parameter_button(i,p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                        <td>
                            Name: <input type="text" size="30" :value="i.name" v-model="i.name">
                        </td>
                          <td>
                            Required? <span class="material-switch pull-right"><input type="checkbox" :value="i.required" v-model="i.required" :id="'required_edit' + p"><label :for="'required_edit' + p" class="btn-info"></label></span>
                          </td>
                        <td>
                              Type: <select v-model="i.type">
                                        <option value="Select One...">Select One...</option>
                                        <option value="String">String</option>
                                        <option value="Boolean">Boolean</option>
                                        <option value="File">File</option>
                                        <option value="Array">Array</option>
                                        <option value="Choice">Choose One</option>
                                        <option value="ChoiceMultiple">Choose Many</option>
                                        <option value="Credential">Credential</option>
                                        <option value="Number">Number</option>
                                    </select>
                          </td>
                        <td>
                            <div v-show="i.type == 'String'">
                                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hint: <input type="text" size="31" :value="i.hint" v-model="i.hint">
                            </div>
                            <div v-show="i.type == 'Choice' || i.type == 'ChoiceMultiple'">
                                &nbsp;&nbsp;One Option per line: <br><textarea size="31" :value="i.choices" v-model="i.choices"></textarea>
                            </div>
                        </td>
                    </tr>
                      <tr>
                          <td colspan="5">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_parameter_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>

                  </table>
                  <h3>Command Transforms:</h3>
                  <table id="edit_command_transforms_table" width="100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th></th>
                          <th align="center"><b>Step</b></th>
                          <th align="center"><b>Transform</b></th>
                          <th align="center"><b>Parameter</b></th>
                          <th align="center"><b>Active?</b></th>
                      </tr>
                      <tr>
                          <td></td>
                          <td align="center">0</td>
                          <td align="center">Get Task Parameters</td>
                          <td align="center">Takes no parameters</td>
                          <td></td>
                      </tr>
                      <tr v-for="(i,p) in add_command_transforms" :key="i.order">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_command_transform_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                          <td align="center"><input type="number" :value="i.order" v-model="i.order" min="1" style="width: 4em"></td>
                          <td align="center">
                              <select v-model="i.name"><option v-for="(item, key, index) in transformOptions" :value="key">[[key]]</option></select>
                          </td>
                          <td align="center">
                              <div v-if="transformOptions[i.name].hasOwnProperty('parameter')">
                                  <input type="text" size="31" :value="i.parameter" v-model="i.parameter" :placeholder="transformOptions[i.name].parameter">
                              </div>
                              <div v-else>
                                  Takes no parameters
                              </div>
                          </td>
                          <td align="center"><span class="material-switch pull-right"><input type="checkbox" :checked="i.active" v-model="i.active" :id="'transform_active' + p"><label :for="'transform_active' + p" class="btn-info"></label></span></td>
                      </tr>
                      <tr>
                          <td colspan="5">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_command_transform_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
                  <h3>ATT&CK Mapping:</h3>
                  <table id="edit_command_attack_table" width="100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th></th>
                          <th>ATT&CK Technique</th>
                      </tr>
                      <tr v-for="(i, p) in add_attack_command" :key="i.t_num">
                          <td>
                              <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_command_attack_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                          </td>
                          <td>
                              <select v-model="i.t_num"><option v-for="item in attackOptions" :value="item.t_num">[[item.t_num]] - [[item.name]]</option></select>
                          </td>
                      </tr>
                      <tr>
                          <td colspan="2">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_command_attack_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
                  <h3>Command Artifacts</h3>
                  <table id="edit_command_artifacts_table" width="100%" class="table table-striped table-hover {{config['table-color']}}">
                      <tr>
                          <th></th>
                          <th>Base Artifact</th>
                          <th>Linked Parameter</th>
                          <th>Artifact</th>
                          <th>Replace String</th>
                      </tr>
                      <tr v-for="(i, p) in add_command_artifact" :key="i.id">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_command_artifact_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                          <td>
                              <select v-model="i.artifact"><option v-for="item in baseArtifacts" :value="item.id">[[item.name]]</option></select>
                          </td>
                          <td>
                              <select v-model="i.command_parameter"><option value="-1">No Parameter</option><option v-for="item in commandParameters" :value="item.id">[[item.name]]</option></select>
                          </td>
                          <td>
                              <textarea v-model="i.artifact_string" :value="i.artifact_string" cols="60"></textarea>
                          </td>
                          <td>
                              <input type="text" size="10" v-model="i.replace_string" :value="i.replace_string">
                          </td>
                      </tr>
                      <tr>
                          <td colspan="5">
                              <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_command_artifact_button()"><i class="fas fa-plus"></i></button>
                          </td>
                      </tr>
                  </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true" id="commandEditCancel">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="commandEditSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR EDITING COMMANDS -->
<!-- THIS IS OUR MODAL FOR EDITING A PAYLOAD TYPE'S LOAD TRANSFORMS -->
<div class="modal fade" id="payloadEditLoadTransformsModal" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
	<div class="modal-content">
	    <div class="modal-header bg-dark text-white">
		<h3>Add / Edit / Remove Transforms for Loading new Commands</h3>
        <button type="button" class="close" data-dismiss="modal">x</button>
	    </div>
	    <div class="modal-body">
            Adjust the transforms applied to the code of a command before an agent is tasked to load it.
            <div id="payloadEditLoadTransformsTable">
                <table cellpadding="10" style="width:100%" class="table table-striped table-hover {{config['table-color']}}">
                    <tr>
                        <th></th>
                        <th align="center"><b>Step</b></th>
                        <th align="center"><b>Input</b></th>
                        <th align="center"><b>Transform</b></th>
                        <th align="center"><b>Parameter</b></th>
                        <th align="center"><b>Output</b></th>
                    </tr>
                    <tr>
                        <td></td>
                        <td align="center">0</td>
                        <td align="center">List of commands -></td>
                        <td align="center">Get command code </td>
                        <td align="center">This transform uses no additional parameter</td>
                        <td align="center">-> Dict[command name, base64 command code]</td>
                    </tr>
                    <tr v-for="(i,p) in loadTransforms" :key="i.order">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_load_transform_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                        <td align="center"><input type="number" :value="i.order" v-model="i.order" min="1" style="width: 4em"></td>
                        <td align="center">[[transformOptions[i.name].prior_output]] -></td>
                        <td align="center">
                            <select id="'loadTransformsOptions' + p" v-model="i.name"><option v-for="(item, key, index) in transformOptions" :value="key">[[key]]</option></select>
                        </td>
                        <td align="center">
                            <div v-if="transformOptions[i.name].hasOwnProperty('parameter')">
                                <input type="text" size="31" :value="i.parameter" v-model="i.parameter" :placeholder="transformOptions[i.name].parameter">
                            </div>
                            <div v-else>
                                This transform uses no additional parameter
                            </div>

                        </td>
                        <td align="center">-> [[transformOptions[i.name].return]]</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td align="center">[[loadTransforms.length + 1]]</td>
                        <td align="center">Final bytes -></td>
                        <td align="center">Register file in system </td>
                        <td align="center">This transform uses no additional parameter</td>
                        <td align="center">-> File ID number</td>
                    </tr>
                </table>
                <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_load_transform_button()"><i class="fas fa-plus"></i></button>
            </div>
        </div>
	    <div class="modal-footer">
		<button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
		<button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadEditLoadTransformsSubmit">Submit</button>
	    </div>
	</div>
    </div>
</div>
<!-- END MODAL FOR EDITING A PAYLOAD TYPE'S LOAD TRANSFORMS -->
<!-- THIS IS OUR MODAL FOR EDITING A PAYLOAD TYPE'S CREATE TRANSFORMS -->
<div class="modal fade" id="payloadEditCreateTransformsModal" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
	<div class="modal-content">
	    <div class="modal-header bg-dark text-white">
		<h3>Add / Edit / Remove Transforms for a New Payload</h3>
        <button type="button" class="close" data-dismiss="modal">x</button>
	    </div>
	    <div class="modal-body">
            Adjust the transforms applied to the code of a new payload after the c2, c2 parameters, uuid, and commands have been stamped in.
            <div id="payloadEditCreateTransformsTable">
                <table cellpadding="10" style="width:100%" class="table table-striped table-hover {{config['table-color']}}" >
                    <tr>
                        <th style="width:4rem"></th>
                        <th align="center" style="width:4rem"><b>Step</b></th>
                        <th align="center"><b>Input</b></th>
                        <th align="center"><b>Transform</b></th>
                        <th align="center"><b>Parameter</b></th>
                        <th align="center"><b>Output</b></th>
                    </tr>
                    <tr>
                        <td></td>
                        <td align="center">0</td>
                        <td align="center">Newly Created Payload</td>
                        <td align="center">Get Path to payload.extension </td>
                        <td align="center">This transform uses no additional parameter</td>
                        <td align="center">FilePath</td>
                    </tr>
                    <tr v-for="(i,p) in createTransforms" :key="i.order">
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_create_transform_button(i, p)"><i class="fas fa-trash-alt"></i></button>
                        </td>
                        <td align="center"><input type="number" v-model="i.order" min="1" style="width: 3em"></td>
                        <td align="center">[[transformOptions[i.name].prior_output]] -></td>
                        <td align="center">
                            <select id="'createTransformsOptions' + p" v-model="i.name"><option v-for="(item, key, index) in transformOptions" :value="key">[[key]]</option></select>
                        </td>
                        <td align="center">
                            <div v-if="transformOptions[i.name].hasOwnProperty('parameter')">
                                <input type="text" size="31" :value="i.parameter" v-model="i.parameter" :placeholder="transformOptions[i.name].parameter">
                            </div>
                            <div v-else>
                                This transform uses no additional parameter
                            </div>

                        </td>
                        <td align="center">-> [[transformOptions[i.name].return]]</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td align="center">[[createTransforms.length + 1]]</td>
                        <td align="center">Final file path to register</td>
                        <td align="center">Register file in system </td>
                        <td align="center">This transform uses no additional parameter</td>
                        <td align="center">File ID number</td>
                    </tr>
                </table>
                <button type="button" class="btn btn{{config['outline-buttons']}}success btn-sm" @click="add_create_transform_button()"><i class="fas fa-plus"></i></button>
            </div>
        </div>
	    <div class="modal-footer">
		<button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
		<button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="payloadEditCreateTransformsSubmit">Submit</button>
	    </div>
	</div>
    </div>
</div>
<!-- END MODAL FOR EDITING A PAYLOAD TYPE'S CREATE TRANSFORMS -->

{% endblock %}

{% block scripts %}
{% include "payload_management.js" %}
{% endblock %}

{% block body_config %}

{% endblock %}